#!/bin/sh
set -e
echo 'ðŸ” Running resolver checks...'

echo 'âž¡ï¸ npm audit (resolver)'
npm audit fix|| { echo 'âŒ audit not fixed'; exit 1; }

echo 'âž¡ï¸ lint-staged (resolver)'
npx lint-staged || { echo 'âŒ lint-staged failed for resolver'; exit 1; }

echo 'âž¡ï¸ typecheck (resolver)'
npm run build:ci || { echo 'âŒ build:ci failed'; exit 1; }

echo 'âž¡ï¸ dependencies check'
npm run knip || { echo 'âŒ Dependency check failed.'; exit 1; }

echo 'âž¡ï¸ lint check'
npm run lint || { echo 'âŒ lint check failed.'; exit 1; }

echo 'ðŸ” Running static resources checks...'
pushd static > /dev/null

echo 'âž¡ï¸ npm audit (resolver)'
npm audit fix|| { echo 'âŒ audit not fixed'; exit 1; }

echo 'âž¡ï¸ lint-staged (static resources)'
npx lint-staged || { echo 'âŒ lint-staged failed for static resources'; popd > /dev/null; exit 1; }


echo 'âž¡ï¸ dependencies check'
npm run knip || { echo 'âŒ Dependency check for static resources failed.'; exit 1; }

echo 'âž¡ï¸ build'
npm run build || { echo 'âŒ Build failed'; popd > /dev/null; exit 1; }

echo 'âž¡ï¸ lint check'
npm run lint || { echo 'âŒ lint check failed.'; exit 1; }

popd > /dev/null